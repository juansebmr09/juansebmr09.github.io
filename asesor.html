<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Reclamaciones</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
        .modal-centered { display: flex; align-items: center; justify-content: center; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-scroll::-webkit-scrollbar { width: 8px; }
        .modal-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .modal-scroll::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .input-error { border-color: #ef4444 !important; ring: 2px; --tw-ring-color: #fca5a5; }
        .slide-in { animation: slideIn 0.3s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes slideIn { to { opacity: 1; transform: translateY(0); } }
        
        /* Estilo para fila bajo reclamación global (Solo color, sin bloqueo) */
        .row-global-active { background-color: #fffbeb !important; } /* Amber-50 */
        .row-global-active:hover { background-color: #fef3c7 !important; } /* Amber-100 */
    </style>
</head>
<body class="bg-white text-gray-800 h-screen flex flex-col relative">

    <header class="relative w-full bg-[#007cc3]">
        <img src="Headder.png" alt="Header Corporativo" class="w-full h-auto object-cover block min-h-[50px]">
        <a href="consulta.html" class="absolute top-0 left-0 h-full w-[90px] cursor-pointer hover:bg-white/10 transition duration-200" title="Ir a Consulta"></a>
    </header>

    <main class="flex-grow bg-white pb-24"> 
        <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-10">
            
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Reclamaciones comisiones</h2>
                    <p class="text-sm text-gray-500 mt-1 max-w-2xl">Radicación y gestión de reclamación de comisiones</p>
                </div>
                
                <div class="flex gap-3">
                    <button id="btnOpenGlobalClaim" class="hidden bg-amber-500 hover:bg-amber-600 text-white text-sm font-bold py-2.5 px-5 rounded shadow-sm inline-flex items-center gap-2 transition-colors animate-[fadeIn_0.5s]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
                        </svg>
                        Reclamación Global Periodo
                    </button>

                    <button id="btnOpenNewClaim" class="bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2.5 px-5 rounded shadow-sm inline-flex items-center gap-2 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                        Nuevo Registro
                    </button>
                </div>
            </div>

            <div class="flex flex-col xl:flex-row gap-6 mb-8 items-start">
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 w-full">
                    
                    <div class="relative"><select id="filter_anio" class="w-full bg-gray-50 border-l-[5px] border-blue-600 text-gray-600 py-3 px-4 shadow-sm text-sm"><option value="">Año</option><option value="2025">2025</option><option value="2024">2024</option></select><div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></div>
                    
                    <div class="relative"><select id="filter_periodo" class="w-full bg-gray-50 border-l-[5px] border-blue-600 text-gray-600 py-3 px-4 shadow-sm text-sm"><option value="">Periodo</option><option value="Ene">Ene</option><option value="Feb">Feb</option><option value="Mar">Mar</option><option value="Abr">Abr</option><option value="May">May</option><option value="Jun">Jun</option></select><div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></div>
                    
                    <div class="relative">
                        <select id="filter_tipodoc" class="w-full bg-gray-50 border-l-[5px] border-blue-600 text-gray-600 py-3 px-4 shadow-sm text-sm">
                            <option value="">Tipo de documento</option>
                            <option value="CC - Cédula de ciudadanía">CC - Cédula de ciudadanía</option>
                            <option value="TI - Tarjeta de identidad">TI - Tarjeta de identidad</option>
                            <option value="CE - Cédula de extranjería">CE - Cédula de extranjería</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                    </div>
                    
                    <div class="relative"><input id="filter_numdoc" type="text" placeholder="Número de documento" class="w-full bg-gray-50 border-l-[5px] border-blue-600 text-gray-600 py-3 px-4 shadow-sm text-sm placeholder-gray-500"></div>
                </div>
                
                <div class="flex flex-col gap-3 min-w-[160px]">
                    <button id="btnConsultar" class="bg-[#1e40af] text-white text-sm font-bold py-2.5 px-6 rounded flex items-center justify-center gap-2 shadow-sm hover:bg-blue-900 transition">CONSULTAR</button>
                    <button id="btnLimpiar" class="bg-[#007cc3] text-white text-sm font-bold py-2.5 px-6 rounded flex items-center justify-center gap-2 shadow-sm hover:bg-sky-700 transition">LIMPIAR</button>
                </div>
            </div>

            <div id="errorMsg" class="hidden text-red-600 bg-red-50 p-3 rounded border border-red-200 text-sm font-bold mb-4 text-center"></div>

            <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4 shadow-sm">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                    <div class="flex flex-col border-r border-blue-200 pr-4"><span class="text-gray-500 text-xs uppercase font-bold tracking-wider">No. Solicitud</span><span id="header_solicitud" class="font-bold text-blue-700 text-base">Cargando...</span></div>
                    <div class="flex flex-col border-r border-blue-200 pr-4"><span class="text-gray-500 text-xs uppercase font-bold tracking-wider">Código Asesor</span><span class="font-semibold text-gray-800">4521</span></div>
                    <div class="flex flex-col border-r border-blue-200 pr-4"><span class="text-gray-500 text-xs uppercase font-bold tracking-wider">Cédula Asesor</span><span class="font-semibold text-gray-800">1.020.304.050</span></div>
                    <div class="flex flex-col"><span class="text-gray-500 text-xs uppercase font-bold tracking-wider">Nombre Asesor</span><span class="font-semibold text-gray-800">Nathalia Rendon</span></div>
                </div>
            </div>
            
            <div id="globalStatusBanner" class="hidden mb-4 bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-center gap-3 animate-[fadeIn_0.3s]">
                <div class="bg-amber-100 p-2 rounded-full text-amber-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
                <div>
                    <h4 class="font-bold text-amber-900 text-sm">Periodo en Reclamación Global</h4>
                    <p class="text-amber-700 text-xs">Este periodo tiene una reclamación masiva activa (ID: <span id="lblGlobalID" class="font-mono font-bold"></span>). Puede agregar detalles individuales si lo requiere.</p>
                </div>
            </div>

            <div class="border border-gray-300 rounded-t-lg overflow-hidden z-0 relative min-h-[150px]">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-300">
                        <thead class="bg-[#eeeeee]">
                            <tr>
                                <th class="px-4 py-3 text-center border-r border-gray-300 w-10">
                                    <input type="checkbox" id="selectAllRows" class="form-checkbox h-4 w-4 text-blue-600 rounded border-gray-400 focus:ring-blue-500 cursor-pointer">
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300 min-w-[100px]">Fecha</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300">Plan</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300">Programa</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300">Contrato</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300">ID Contratante</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300">ID Usuario</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300">Usuario</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300">Parentesco</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-black uppercase border-r border-gray-300">Pago</th>
                                <th class="px-4 py-3 text-center text-xs font-bold text-black uppercase min-w-[100px]">Detalle</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
                <div id="noResultsMsg" class="hidden py-10 text-center text-gray-500 italic">No se encontraron resultados con esos filtros.</div>
            </div>

            <div class="bg-gray-100 border border-t-0 border-gray-300 rounded-b-lg p-4 flex flex-col md:flex-row justify-between items-center gap-4 shadow-sm sticky bottom-0 z-20">
                <div class="flex items-center gap-3 w-full md:w-auto bg-white p-2 rounded border border-dashed border-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" /></svg>
                    <div class="relative overflow-hidden inline-block">
                        <button class="border border-gray-300 bg-gray-50 hover:bg-gray-100 text-gray-700 font-medium py-1 px-3 rounded text-sm transition">Adjuntar Soporte Masivo</button>
                        <input type="file" class="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer">
                    </div>
                    <span class="text-xs text-gray-500 hidden sm:inline">Para los registros seleccionados</span>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <button id="btnFilterSelected" class="flex-1 md:flex-none bg-amber-500 hover:bg-amber-600 text-white font-bold py-2.5 px-5 rounded shadow-sm transition flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>Filtrar Seleccionados</button>
                    <button id="btnSendAll" class="flex-1 md:flex-none bg-[#1e40af] hover:bg-blue-900 text-white font-bold py-2.5 px-6 rounded shadow-sm transition flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>Enviar Gestión</button>
                </div>
            </div>
        </div>
    </main>

    <div id="commentModal" class="fixed inset-0 bg-gray-800 bg-opacity-60 hidden overflow-y-auto h-full w-full z-40 modal-centered">
        <div class="relative mx-auto p-6 border w-[95%] max-w-2xl shadow-2xl rounded-xl bg-white animate-[fade-in_0.2s_ease-out]">
            <div class="flex items-center justify-between mb-5">
                 <h3 id="modalTitle" class="text-xl font-bold text-gray-900 flex items-center gap-2">Gestión de Motivos</h3>
                 <button class="js-close-comment text-gray-400 hover:text-gray-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <div class="mt-2">
                <input type="hidden" id="currentRowIdInput">
                <div class="mb-4">
                    <label class="block text-sm font-bold text-gray-700 mb-2">Seleccione los Motivos:</label>
                    <div id="editMotivosList" class="grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-40 overflow-y-auto border border-gray-200 p-2 rounded">
                        </div>
                </div>
                
                <label class="block text-sm font-bold text-gray-700 mb-2">Observaciones por motivo:</label>
                <div id="editObservationsContainer" class="flex flex-col gap-3 max-h-60 overflow-y-auto pr-1">
                    <p class="text-sm text-gray-400 italic" id="editEmptyState">Seleccione un motivo para agregar observaciones.</p>
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button class="js-close-comment px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition font-medium">Cerrar</button>
                <button id="btnSaveComment" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition font-bold flex items-center gap-2">Guardar</button>
            </div>
        </div>
    </div>

    <div id="newClaimModal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden overflow-y-auto h-full w-full z-50 flex items-center justify-center py-10">
        <div class="relative mx-auto w-[95%] max-w-4xl shadow-2xl rounded-xl bg-white animate-[fade-in_0.2s_ease-out] flex flex-col max-h-full">
            <div class="flex items-center justify-between px-8 py-5 border-b border-gray-100">
                <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2"><div class="bg-green-100 text-green-600 p-2 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>Nuevo Registro</h3>
                <button class="js-close-new-claim text-gray-400 hover:text-red-500 transition-colors"><svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <div class="px-8 py-6 overflow-y-auto modal-scroll">
                <form id="newClaimForm">
                    <div class="mb-6">
                        <h4 class="text-sm uppercase tracking-wide text-gray-500 font-bold mb-4 border-b pb-2">Datos Generales</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Año <span class="text-red-500">*</span></label><select id="new_anio" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"><option value="">Seleccione...</option><option>2025</option><option>2024</option></select></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Periodo <span class="text-red-500">*</span></label><select id="new_periodo" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"><option value="">Seleccione...</option><option>Ene</option><option>Feb</option><option>Mar</option><option>Abr</option><option>May</option><option>Jun</option></select></div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de documento <span class="text-red-500">*</span></label>
                                <select id="new_tipo_doc" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50">
                                    <option value="">Seleccione...</option>
                                    <option value="CC - Cédula de ciudadanía">CC - Cédula de ciudadanía</option>
                                    </select>
                            </div>
                            
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Número de documento <span class="text-red-500">*</span></label><input id="new_documento" type="number" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ej: 123456789"></div>
                        </div>
                    </div>
                    <div class="mb-6">
                        <h4 class="text-sm uppercase tracking-wide text-gray-500 font-bold mb-4 border-b pb-2">Detalles del Contrato</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Plan <span class="text-red-500">*</span></label><select id="new_plan" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"><option value="">Seleccione...</option><option>Familiar</option><option>Asociado</option></select></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Programa <span class="text-red-500">*</span></label><select id="new_programa" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"><option value="">Seleccione...</option><option>Oro</option><option>Plata</option><option>Bronce</option></select></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Contrato <span class="text-red-500">*</span></label><input id="new_contrato" type="number" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 bg-white" placeholder="Número contrato"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">ID Contratante <span class="text-red-500">*</span></label><input id="new_id_contratante" type="number" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ej: 998877"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">ID Usuario <span class="text-red-500">*</span></label><input id="new_id_usuario" type="number" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ej: 112233"></div>
                            
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Nombre Usuario <span class="text-red-500">*</span></label><input id="new_usuario" type="text" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Nombre completo"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Parentesco <span class="text-red-500">*</span></label><select id="new_parentezco" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"><option value="">Seleccione...</option><option>Titular</option><option>Cónyuge</option></select></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1">Forma de pago <span class="text-red-500">*</span></label><select id="new_pago" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"><option value="">Seleccione...</option><option>Prepago</option><option>Pospago</option></select></div>
                        </div>
                    </div>

                    <div class="mb-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <label class="block text-base font-bold text-blue-800 mb-3 border-b pb-1">Motivos de Reclamación (Selección Múltiple)</label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4" id="newMotivosList">
                            </div>

                        <div id="newObservationsContainer" class="flex flex-col gap-4">
                            <p class="text-sm text-gray-400 italic text-center py-2">Seleccione al menos un motivo arriba para detallar la observación.</p>
                        </div>
                    </div>

                </form>
            </div>
            <div class="px-8 py-5 bg-gray-50 border-t border-gray-100 flex justify-end gap-3 rounded-b-xl">
                <button class="js-close-new-claim px-6 py-2.5 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition shadow-sm">Cancelar</button>
                <button id="btnRealSaveClaim" class="px-6 py-2.5 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition shadow-md flex items-center gap-2">Guardar</button>
            </div>
        </div>
    </div>

    <div id="globalClaimModal" class="fixed inset-0 bg-amber-900 bg-opacity-70 hidden overflow-y-auto h-full w-full z-50 flex items-center justify-center py-10">
        <div class="relative mx-auto w-[95%] max-w-2xl shadow-2xl rounded-xl bg-white animate-[fade-in_0.3s_ease-out] flex flex-col">
            <div class="flex items-center justify-between px-8 py-5 border-b border-amber-100 bg-amber-50 rounded-t-xl">
                <div>
                    <h3 class="text-xl font-bold text-amber-900 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                        Reclamación Global del Periodo
                    </h3>
                    <p class="text-sm text-amber-700 mt-1">Impugnación de todos los registros para: <span id="globalModalPeriod" class="font-bold"></span></p>
                </div>
                <button class="js-close-global-claim text-gray-400 hover:text-amber-600"><svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            
            <div class="px-8 py-6">
                <div class="mb-4 p-4 bg-blue-50 text-blue-800 text-sm rounded border border-blue-100 flex gap-2">
                    <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                    <p>Al crear una reclamación global, se creará un Ticket Maestro para agrupar las incidencias, pero <strong>podrá seguir editando</strong> los detalles individuales si lo requiere.</p>
                </div>

                <form id="globalClaimForm">
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-1">Motivo General <span class="text-red-500">*</span></label>
                        <select id="global_motivo" class="w-full border border-gray-300 rounded-md p-2.5 focus:ring-amber-500 focus:border-amber-500">
                            <option value="">Seleccione el motivo principal...</option>
                            <option value="Error Masivo en Aceleradores">Error Masivo en Aceleradores</option>
                            <option value="Base Garantizada no aplicada">Base Garantizada no aplicada</option>
                            <option value="Fallas en cargue de recaudos">Fallas en cargue de recaudos</option>
                            <option value="Inconsistencia en Tarifas">Inconsistencia en Tarifas</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-1">Descripción detallada <span class="text-red-500">*</span></label>
                        <textarea id="global_descripcion" rows="4" class="w-full border border-gray-300 rounded-md p-3 focus:ring-amber-500 focus:border-amber-500" placeholder="Explique por qué impugna el periodo completo..."></textarea>
                    </div>

                    <div class="mb-2">
                        <label class="block text-sm font-bold text-gray-700 mb-1">Soporte de Evidencia (Obligatorio)</label>
                        <div class="flex items-center justify-center w-full">
                            <label for="global_file" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                    </svg>
                                    <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click para subir</span> o arrastre el archivo</p>
                                    <p class="text-xs text-gray-500">Excel, PDF, ZIP (MAX. 10MB)</p>
                                </div>
                                <input id="global_file" type="file" class="hidden" />
                            </label>
                        </div> 
                    </div>
                </form>
            </div>

            <div class="px-8 py-5 bg-gray-50 border-t border-gray-200 flex justify-end gap-3 rounded-b-xl">
                <button class="js-close-global-claim px-6 py-2.5 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition shadow-sm">Cancelar</button>
                <button id="btnSaveGlobalClaim" class="px-6 py-2.5 bg-amber-600 hover:bg-amber-700 text-white font-bold rounded-lg transition shadow-md flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                    Radicar Global
                </button>
            </div>
        </div>
    </div>

    <footer class="bg-white border-t border-gray-200 mt-auto py-6">
        <div class="max-w-[1600px] mx-auto px-4 text-center">
            <a href="OVA.html" class="text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors inline-flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Volver a los otros roles del mockup
            </a>
        </div>
    </footer>

    <script>
        // --- LISTA DE MOTIVOS (Para usar en Filtros y Nuevo Registro) ---
        const motivosList = [
            "Pago no cruzado",
            "Valor de comisión errado",
            "Descuento injustificado",
            "Error en acelerador",
            "Venta mal cargada",
            "Beneficiario incorrecto",
            "Otro motivo"
        ];

        // --- BASE DE DATOS SIMULADA ---
        // Agregamos propiedad 'globalClaimId' para rastrear si pertenecen a una reclamación global
        let mockDatabase = [
            {
                id: 'fila_ejemplo',
                fecha: '2025-01-15', 
                anio: '2025', periodo: 'Ene', tipoDoc: 'CC - Cédula de ciudadanía', numDoc: '123456789',
                plan: 'Familiar', programa: 'Oro', contrato: 'CT-001', 
                idContratante: '998877', idUsuario: '112233', 
                usuario: 'Juan Pérez', parentesco: 'Titular', pago: 'Pospago',
                motivos: [],
                globalClaimId: null // Nueva propiedad
            },
            {
                id: 'fila_prueba_1',
                fecha: '2025-01-18',
                anio: '2025', periodo: 'Ene', tipoDoc: 'CC - Cédula de ciudadanía', numDoc: '1234',
                plan: 'Familiar', programa: 'Oro', contrato: '1001', 
                idContratante: '556677', idUsuario: '334455',
                usuario: 'Maria Lopez', parentesco: 'Titular', pago: 'Prepago',
                motivos: [
                    { motivo: 'Pago no cruzado', observacion: 'No se reflejó el pago de la cuota inicial.' }
                ],
                globalClaimId: null
            }
        ];

        // Almacén de reclamaciones globales activas
        let globalClaims = []; // { id: 'GL-2025-ENE-01', anio: '2025', periodo: 'Ene' ... }

        // --- RENDERIZAR OPCIONES DE MOTIVOS ---

        // Función para renderizar Motivos + Textareas Dinámicos (Reutilizable para Nuevo y Editar)
        function setupDynamicMotivos(listContainerId, obsContainerId, prefix) {
            const listContainer = document.getElementById(listContainerId);
            const obsContainer = document.getElementById(obsContainerId);
            listContainer.innerHTML = ''; 

            motivosList.forEach((m, index) => {
                const uniqueId = `${prefix}_chk_${index}`;
                const div = document.createElement('div');
                div.className = "flex items-center";
                div.innerHTML = `
                    <input type="checkbox" id="${uniqueId}" value="${m}" class="form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500 cursor-pointer mr-2">
                    <label for="${uniqueId}" class="text-sm text-gray-700 cursor-pointer select-none">${m}</label>
                `;
                
                // Evento al hacer click en el checkbox
                const checkbox = div.querySelector('input');
                checkbox.addEventListener('change', function() {
                    const existingObs = document.getElementById(`${prefix}_obs_div_${index}`);
                    
                    if (this.checked) {
                        // Crear textarea si no existe
                        if (!existingObs) {
                            const obsDiv = document.createElement('div');
                            obsDiv.id = `${prefix}_obs_div_${index}`;
                            obsDiv.className = "slide-in bg-blue-50 p-3 rounded border border-blue-100";
                            obsDiv.innerHTML = `
                                <label class="block text-xs font-bold text-blue-800 mb-1">Observación para: ${m}</label>
                                <textarea id="${prefix}_txt_${index}" rows="2" class="w-full border border-gray-300 rounded p-2 text-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Detalles específicos..."></textarea>
                            `;
                            obsContainer.appendChild(obsDiv);
                            
                            // Remover mensaje vacío si existe
                            const emptyMsg = obsContainer.querySelector('.italic');
                            if(emptyMsg) emptyMsg.style.display = 'none';
                        }
                    } else {
                        // Eliminar textarea si existe
                        if (existingObs) existingObs.remove();
                        // Mostrar mensaje vacío si no queda nada
                        if (obsContainer.children.length === 0 || (obsContainer.children.length === 1 && obsContainer.querySelector('.italic'))) {
                            const emptyMsg = obsContainer.querySelector('.italic');
                            if(emptyMsg) emptyMsg.style.display = 'block';
                        }
                    }
                });

                listContainer.appendChild(div);
            });
        }

        // Inicializar lógica dinámica en Modal Nuevo
        setupDynamicMotivos('newMotivosList', 'newObservationsContainer', 'new');
        // Inicializar lógica dinámica en Modal Editar
        setupDynamicMotivos('editMotivosList', 'editObservationsContainer', 'edit');


        // --- LOGICA DE HEADER ---
        const initHeaderData = () => {
            let consecutiveCounter = 1;
            const fixedCode = "4521";
            const currentYear = new Date().getFullYear();
            const consecutiveStr = String(consecutiveCounter).padStart(3, '0');
            document.getElementById('header_solicitud').innerText = `${fixedCode}${currentYear}${consecutiveStr}`;
        };
        initHeaderData();

        // --- GESTIÓN COMENTARIOS Y MODAL EDITAR ---
        const commentModal = document.getElementById('commentModal');
        const currentRowInput = document.getElementById('currentRowIdInput');
        const btnSaveComment = document.getElementById('btnSaveComment');
        const modalTitle = document.getElementById('modalTitle');

        const openCommentModal = () => commentModal.classList.remove('hidden');
        const closeCommentModal = () => commentModal.classList.add('hidden');
        document.querySelectorAll('.js-close-comment').forEach(btn => btn.addEventListener('click', closeCommentModal));

        // Click en tabla (Ver u Editar)
        document.getElementById('tableBody').addEventListener('click', (e) => {
            const btn = e.target.closest('.js-view-details') || e.target.closest('.js-edit-details');
            if (!btn) return;

            const rowId = btn.closest('tr').getAttribute('data-row-id');
            const record = mockDatabase.find(r => r.id === rowId);
            
            currentRowInput.value = rowId;

            // Limpiar modal previo
            const listContainer = document.getElementById('editMotivosList');
            const obsContainer = document.getElementById('editObservationsContainer');
            obsContainer.innerHTML = '<p class="text-sm text-gray-400 italic" id="editEmptyState">Seleccione un motivo para agregar observaciones.</p>';
            listContainer.querySelectorAll('input').forEach(chk => chk.checked = false);

            // Cargar datos existentes
            if (record && record.motivos) {
                record.motivos.forEach(mObj => {
                    // Buscar índice del motivo
                    const idx = motivosList.indexOf(mObj.motivo);
                    if (idx !== -1) {
                        const checkbox = document.getElementById(`edit_chk_${idx}`);
                        if (checkbox) {
                            checkbox.checked = true;
                            // Disparar evento change manualmente para crear el textarea
                            checkbox.dispatchEvent(new Event('change'));
                            // Llenar el valor
                            const txt = document.getElementById(`edit_txt_${idx}`);
                            if(txt) txt.value = mObj.observacion;
                        }
                    }
                });
            }

            const isReadOnly = btn.classList.contains('js-view-details'); 
            const hasData = record.motivos && record.motivos.length > 0;

            if (isReadOnly) {
                // Modo Ver: Solo lectura
                if (hasData) {
                    modalTitle.innerText = "Detalle de Motivos";
                    btnSaveComment.classList.add('hidden');
                    // Deshabilitar inputs
                    listContainer.querySelectorAll('input').forEach(i => i.disabled = true);
                    obsContainer.querySelectorAll('textarea').forEach(t => t.disabled = true);
                } else {
                    // Ver detalles pero está vacío -> Permitir agregar
                    modalTitle.innerText = "Agregar Motivos";
                    btnSaveComment.classList.remove('hidden');
                    listContainer.querySelectorAll('input').forEach(i => i.disabled = false);
                }
            } else {
                // Modo Editar
                modalTitle.innerText = "Editar Motivos";
                btnSaveComment.classList.remove('hidden');
                listContainer.querySelectorAll('input').forEach(i => i.disabled = false);
            }

            openCommentModal();
        });

        // Guardar Edición
        btnSaveComment.addEventListener('click', () => {
            const rowId = currentRowInput.value;
            const record = mockDatabase.find(r => r.id === rowId);
            
            // Recolectar datos del form dinámico de edición
            const newMotivosData = [];
            motivosList.forEach((m, idx) => {
                const chk = document.getElementById(`edit_chk_${idx}`);
                if(chk && chk.checked) {
                    const txt = document.getElementById(`edit_txt_${idx}`);
                    newMotivosData.push({
                        motivo: m,
                        observacion: txt ? txt.value : ''
                    });
                }
            });

            if (newMotivosData.length === 0) {
                alert("Debe seleccionar al menos un motivo.");
                return;
            }

            if(record) record.motivos = newMotivosData;
            
            // Actualizar vista lápiz
            const row = document.querySelector(`tr[data-row-id="${rowId}"]`);
            if(row) {
                const editBtn = row.querySelector('.js-edit-details');
                if(editBtn) editBtn.classList.remove('hidden');
            }

            closeCommentModal();
        });


        // --- NUEVO REGISTRO ---
        const newClaimModal = document.getElementById('newClaimModal');
        const btnOpenNewClaim = document.getElementById('btnOpenNewClaim');
        
        btnOpenNewClaim.addEventListener('click', () => {
            newClaimModal.classList.remove('hidden');
            document.getElementById('newClaimForm').reset();
            // Resetear area dinámica
            const obsContainer = document.getElementById('newObservationsContainer');
            obsContainer.innerHTML = '<p class="text-sm text-gray-400 italic text-center py-2">Seleccione al menos un motivo arriba para detallar la observación.</p>';
        });
        
        document.querySelectorAll('.js-close-new-claim').forEach(btn => btn.addEventListener('click', () => newClaimModal.classList.add('hidden')));

        document.getElementById('btnRealSaveClaim').addEventListener('click', () => {
            
            // Recolectar motivos
            const newMotivosData = [];
            motivosList.forEach((m, idx) => {
                const chk = document.getElementById(`new_chk_${idx}`);
                if(chk && chk.checked) {
                    const txt = document.getElementById(`new_txt_${idx}`);
                    newMotivosData.push({
                        motivo: m,
                        observacion: txt ? txt.value : ''
                    });
                }
            });

            if(newMotivosData.length === 0) {
                alert("Por favor seleccione al menos un Motivo.");
                return;
            }

            const newRecord = {
                id: 'fila_' + Date.now(),
                fecha: new Date().toISOString().split('T')[0], 
                anio: document.getElementById('new_anio').value,
                periodo: document.getElementById('new_periodo').value,
                tipoDoc: document.getElementById('new_tipo_doc').value,
                numDoc: document.getElementById('new_documento').value,
                plan: document.getElementById('new_plan').value,
                programa: document.getElementById('new_programa').value,
                contrato: document.getElementById('new_contrato').value,
                idContratante: document.getElementById('new_id_contratante').value,
                idUsuario: document.getElementById('new_id_usuario').value,
                usuario: document.getElementById('new_usuario').value,
                parentesco: document.getElementById('new_parentezco').value,
                pago: document.getElementById('new_pago').value,
                motivos: newMotivosData,
                globalClaimId: null
            };

            mockDatabase.push(newRecord);
            newClaimModal.classList.add('hidden');
            alert("✅ Registro guardado. Presione Consultar para actualizar.");
        });

        // --- LOGICA RECLAMACIÓN GLOBAL ---
        const btnOpenGlobalClaim = document.getElementById('btnOpenGlobalClaim');
        const globalClaimModal = document.getElementById('globalClaimModal');
        const btnSaveGlobalClaim = document.getElementById('btnSaveGlobalClaim');

        btnOpenGlobalClaim.addEventListener('click', () => {
            const anio = document.getElementById('filter_anio').value;
            const periodo = document.getElementById('filter_periodo').value;
            
            document.getElementById('globalModalPeriod').innerText = `${periodo} ${anio}`;
            globalClaimModal.classList.remove('hidden');
        });

        document.querySelectorAll('.js-close-global-claim').forEach(btn => btn.addEventListener('click', () => globalClaimModal.classList.add('hidden')));

        btnSaveGlobalClaim.addEventListener('click', () => {
            const motivo = document.getElementById('global_motivo').value;
            const desc = document.getElementById('global_descripcion').value;
            // Aquí validaríamos el archivo
            
            if(!motivo || !desc) {
                alert("Complete el motivo y la descripción para la reclamación global.");
                return;
            }

            const anio = document.getElementById('filter_anio').value;
            const periodo = document.getElementById('filter_periodo').value;
            const globalID = `GL-${anio}-${periodo}-${Math.floor(Math.random()*1000)}`;

            // Guardar en "Base de datos" global
            globalClaims.push({
                id: globalID,
                anio: anio,
                periodo: periodo,
                motivo: motivo,
                descripcion: desc
            });

            // Actualizar TODOS los registros que coincidan con el periodo en la BD
            let updatedCount = 0;
            mockDatabase.forEach(row => {
                if(row.anio === anio && row.periodo === periodo) {
                    row.globalClaimId = globalID;
                    updatedCount++;
                }
            });

            globalClaimModal.classList.add('hidden');
            alert(`✅ Se ha generado la Reclamación Global ${globalID}. Se han asociado ${updatedCount} registros.`);
            
            // Simular click en consultar para refrescar la tabla
            document.getElementById('btnConsultar').click();
        });


        // --- RENDER TABLA ---
        function renderRow(item) {
            const hasMotivos = item.motivos && item.motivos.length > 0;
            const isGlobal = !!item.globalClaimId;
            
            let rowClass = 'hover:bg-gray-50 transition-colors h-12 slide-in';
            let globalIndicator = '';

            // SI ES GLOBAL: Solo pintamos de amarillo, PERO NO BLOQUEAMOS NADA
            if (isGlobal) {
                rowClass += ' row-global-active'; // Color amarillo
                globalIndicator = `
                    <span class="text-amber-600 mr-2" title="Registro parte de Reclamación Global">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                    </span>
                `;
            }

            const pencilClass = hasMotivos ? '' : 'hidden';
            
            // Botones de acción siempre activos
            const actionButtons = `
                ${globalIndicator}
                <button class="js-view-details text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 p-2 rounded-full transition-colors" title="Ver motivos">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                </button>
                <button class="js-edit-details ${pencilClass} text-white bg-amber-500 hover:bg-amber-600 p-2 rounded-full shadow-sm fade-in ml-2" title="Editar motivos">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>
                </button>
            `;

            const html = `
                <tr data-row-id="${item.id}" class="${rowClass}">
                    <td class="px-4 py-2 text-center border-r border-gray-200">
                        <input type="checkbox" class="row-checkbox form-checkbox h-4 w-4 text-blue-600 rounded border-gray-400 focus:ring-blue-500 cursor-pointer">
                    </td>
                    <td class="border-r border-gray-200 px-4 py-2 font-medium text-gray-700 text-xs">${item.fecha}</td>
                    
                    <td class="border-r border-gray-200 px-2 text-sm">${item.plan}</td>
                    <td class="border-r border-gray-200 px-2 text-sm">${item.programa}</td>
                    <td class="border-r border-gray-200 px-2 text-sm">${item.contrato}</td>
                    <td class="border-r border-gray-200 px-2 text-sm">${item.idContratante}</td>
                    <td class="border-r border-gray-200 px-2 text-sm">${item.idUsuario}</td>
                    <td class="border-r border-gray-200 px-2 text-sm">${item.usuario}</td>
                    <td class="border-r border-gray-200 px-2 text-sm">${item.parentesco}</td>
                    <td class="border-r border-gray-200 px-2 text-sm">${item.pago}</td>
                    <td class="px-2 py-2">
                        <div class="actions-cell flex items-center justify-center">
                            ${actionButtons}
                        </div>
                    </td>
                </tr>
            `;
            document.getElementById('tableBody').insertAdjacentHTML('beforeend', html);
        }

        // --- CONSULTAR ---
        document.getElementById('btnConsultar').addEventListener('click', () => {
            const fAnio = document.getElementById('filter_anio').value;
            const fPeriodo = document.getElementById('filter_periodo').value;
            const fTipoDoc = document.getElementById('filter_tipodoc').value;
            const fNumDoc = document.getElementById('filter_numdoc').value.trim();
            
            // MOSTRAR/OCULTAR BOTÓN GLOBAL: Solo si hay AÑO y PERIODO seleccionado
            const btnGlobal = document.getElementById('btnOpenGlobalClaim');
            const globalStatusBanner = document.getElementById('globalStatusBanner');
            
            // Resetear visuales globales
            globalStatusBanner.classList.add('hidden');
            let periodIsGlobalLocked = false;
            let currentGlobalId = '';

            // Verificar si este periodo ya tiene reclamación global
            if (fAnio && fPeriodo) {
                const existingGlobal = globalClaims.find(gc => gc.anio === fAnio && gc.periodo === fPeriodo);
                if (existingGlobal) {
                    periodIsGlobalLocked = true;
                    currentGlobalId = existingGlobal.id;
                    // Si ya está reclamado, no mostramos el botón de crear nueva reclamación global
                    btnGlobal.classList.add('hidden');
                    // Mostramos el banner informativo
                    globalStatusBanner.classList.remove('hidden');
                    document.getElementById('lblGlobalID').innerText = currentGlobalId;
                } else {
                    // Si no está reclamado, mostramos el botón para permitir hacerlo
                    btnGlobal.classList.remove('hidden');
                }
            } else {
                btnGlobal.classList.add('hidden'); // No se puede reclamar sin filtro especifico
            }

            const tableBody = document.getElementById('tableBody');
            const noResultsMsg = document.getElementById('noResultsMsg');
            const errorMsg = document.getElementById('errorMsg');
            
            errorMsg.classList.add('hidden');
            tableBody.innerHTML = "";
            let count = 0;

            mockDatabase.forEach(item => {
                let match = true;
                if (fAnio && item.anio !== fAnio) match = false;
                if (fPeriodo && item.periodo !== fPeriodo) match = false;
                if (fTipoDoc && item.tipoDoc !== fTipoDoc) match = false;
                if (fNumDoc && !item.numDoc.includes(fNumDoc)) match = false;

                if (match) {
                    renderRow(item);
                    count++;
                }
            });

            if(count === 0) noResultsMsg.classList.remove('hidden');
            else noResultsMsg.classList.add('hidden');
        });

        document.getElementById('btnLimpiar').addEventListener('click', () => {
            document.getElementById('filter_anio').value = "";
            document.getElementById('filter_periodo').value = "";
            document.getElementById('filter_tipodoc').value = "";
            document.getElementById('filter_numdoc').value = "";
            
            document.getElementById('tableBody').innerHTML = "";
            document.getElementById('errorMsg').classList.add('hidden');
            document.getElementById('noResultsMsg').classList.add('hidden');
            document.getElementById('btnOpenGlobalClaim').classList.add('hidden'); // Ocultar boton global
            document.getElementById('globalStatusBanner').classList.add('hidden');
        });

        // Botones de acción masiva
        document.getElementById('selectAllRows').addEventListener('change', (e) => {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(cb => cb.checked = e.target.checked);
        });
        document.getElementById('btnFilterSelected').addEventListener('click', () => {
            document.querySelectorAll('#tableBody tr').forEach(row => {
                const cb = row.querySelector('.row-checkbox');
                if(!cb || !cb.checked) row.remove();
            });
        });
        document.getElementById('btnSendAll').addEventListener('click', () => {
             const checkboxes = document.querySelectorAll('.row-checkbox:checked');
             if(checkboxes.length > 0) alert("Gestión enviada correctamente.");
             else alert("No hay registros seleccionados o habilitados para envío.");
        });

    </script>
</body>
</html>